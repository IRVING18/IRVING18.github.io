<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Gradle 构建过程&amp;插件分享 | Android高级直通车</title><meta name="author" content="王征"><meta name="copyright" content="王征"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;YOcFYeo30jhI9DwZnrANFghttps:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;yUsSl0UMYEywgyLA67kuPA 目录 一、初见Build 二、又见Build aapt aidl Java Compiler （即javaC） dex apkbuilder Jarsigner zipalign   三、深入Build">
<meta property="og:type" content="article">
<meta property="og:title" content="Gradle 构建过程&amp;插件分享">
<meta property="og:url" content="https://irving18.github.io/2022/11/27/Gradle%20%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B&%E6%8F%92%E4%BB%B6%E5%88%86%E4%BA%AB/index.html">
<meta property="og:site_name" content="Android高级直通车">
<meta property="og:description" content="https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;YOcFYeo30jhI9DwZnrANFghttps:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;yUsSl0UMYEywgyLA67kuPA 目录 一、初见Build 二、又见Build aapt aidl Java Compiler （即javaC） dex apkbuilder Jarsigner zipalign   三、深入Build">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://irving18.github.io/img/avatar.jpg">
<meta property="article:published_time" content="2022-11-27T07:39:23.000Z">
<meta property="article:modified_time" content="2024-12-27T09:17:19.420Z">
<meta property="article:author" content="王征">
<meta property="article:tag" content="Android进阶">
<meta property="article:tag" content="Gradle插件">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://irving18.github.io/img/avatar.jpg"><link rel="shortcut icon" href="/img/avatar.jpg"><link rel="canonical" href="https://irving18.github.io/2022/11/27/Gradle%20%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B&amp;%E6%8F%92%E4%BB%B6%E5%88%86%E4%BA%AB/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Gradle 构建过程&插件分享',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/bg.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Android高级直通车</span></a><a class="nav-page-title" href="/"><span class="site-name">Gradle 构建过程&amp;插件分享</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Gradle 构建过程&amp;插件分享</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-11-27T07:39:23.000Z" title="发表于 2022-11-27 15:39:23">2022-11-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-12-27T09:17:19.420Z" title="更新于 2024-12-27 17:17:19">2024-12-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Gradle%E6%8F%92%E4%BB%B6/">Gradle插件</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>12分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/YOcFYeo30jhI9DwZnrANFg">https://mp.weixin.qq.com/s/YOcFYeo30jhI9DwZnrANFg</a><br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/yUsSl0UMYEywgyLA67kuPA">https://mp.weixin.qq.com/s/yUsSl0UMYEywgyLA67kuPA</a></p>
<h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ul>
<li><a href="#jump1">一、初见Build</a></li>
<li><a href="#jump2">二、又见Build</a><ul>
<li><a href="#jump2">aapt</a></li>
<li><a href="#jump2">aidl</a></li>
<li><a href="#jump2">Java Compiler （即javaC）</a></li>
<li><a href="#jump2">dex</a></li>
<li><a href="#jump2">apkbuilder</a></li>
<li><a href="#jump2">Jarsigner</a></li>
<li><a href="#jump2">zipalign</a></li>
</ul>
</li>
<li><a href="#jump3">三、深入Build</a></li>
<li><a href="#jump4">四、任务角度看 build</a></li>
<li><a href="#jump5">五、手动build 简单示例</a></li>
<li><a href="#jump6">六、gradle插件基础</a></li>
<li><a href="#jump7">七、GarbageCode示例</a></li>
</ul>
<h1 id="一、初见Build"><a href="#一、初见Build" class="headerlink" title="一、初见Build"></a><span id="jump1" />一、初见Build</h1><blockquote>
<p>方形:表示文件，菱形:表示操作</p>
</blockquote>
<p><img width="500" height="“50”" src="https://note.youdao.com/yws/public/resource/aa2b7a1733f389353b895521feea8e82/xmlnote/WEBRESOURCE332f961d7f55dc9b957d86ffc64e3180/10419"></img></p>
<p>大概流程分为两步</p>
<ul>
<li><strong>编译</strong> : 编译器(Compiler)通过编译 源码 、AIDL文件 、资源文件 、依赖包，最终生成Dex文件和编译后的资源文件。</li>
<li><strong>打包</strong> :打包器(APK Packager)利用签名文件(KeyStore)和上一步编译过程中生成的Dex文件、编译后的资源文件打包成最终的APK文件。</li>
</ul>
<h1 id="二、又见Build"><a href="#二、又见Build" class="headerlink" title="二、又见Build"></a><span id="jump2" />二、又见Build</h1><blockquote>
<p>方形:表示文件，椭圆:表示工具及操作</p>
<p>以虚线为界，前半部分描述了 <strong>编译流程</strong> ，后半部分则描述了 <strong>打包流程</strong>。</p>
</blockquote>
<p><img width="450" height="“50”" src="https://note.youdao.com/yws/public/resource/aa2b7a1733f389353b895521feea8e82/xmlnote/WEBRESOURCE5787f8f53ad1f324bab9a42dd0f458c5/10422"></img></p>
<p>整体操作符流，可分为七步</p>
<ul>
<li><strong>编译</strong> 1-4</li>
<li><strong>打包</strong> 5-7</li>
</ul>
<h4 id="（1）aapt工具"><a href="#（1）aapt工具" class="headerlink" title="（1）aapt工具"></a>（1）aapt工具</h4><ol>
<li>编译res&#x2F;文件，生成<strong>res.zip</strong>文件</li>
<li>res.zip 编译生成二进制资源**.ap_文件**、<strong>R.java</strong>文件。(目前新版使用aapt2工具,R.java也替换成了R.jar)</li>
</ol>
<h4 id="（2）aidl工具"><a href="#（2）aidl工具" class="headerlink" title="（2）aidl工具"></a>（2）aidl工具</h4><ol>
<li>根据项目的aidl文件生成对应的java文件</li>
</ol>
<h4 id="（3）Java-Compiler-（即javaC）工具"><a href="#（3）Java-Compiler-（即javaC）工具" class="headerlink" title="（3）Java Compiler （即javaC）工具"></a>（3）Java Compiler （即javaC）工具</h4><ol>
<li>编译项目中java代码、R.java</li>
<li>Aidl对应的java代码，生成.class字节码文件</li>
</ol>
<h4 id="（4）dex工具"><a href="#（4）dex工具" class="headerlink" title="（4）dex工具"></a>（4）dex工具</h4><ol>
<li>将上一步产生的.class文件和第三方依赖包中的.class编译成.dex文件。（目前新版使用d8工具）</li>
<li>同时也是采用aar repo形式的组件化工程编译速度快的主要原因。</li>
</ol>
<h4 id="（5）apkbuilder工具"><a href="#（5）apkbuilder工具" class="headerlink" title="（5）apkbuilder工具"></a>（5）apkbuilder工具</h4><p>将编译后的资源，压缩成一个.apk文件</p>
<ol>
<li>.ap_文件</li>
<li>.dex文件</li>
<li>其他资源文件(例如：so文件、asset文件等)</li>
</ol>
<h4 id="（6）Jarsigner工具"><a href="#（6）Jarsigner工具" class="headerlink" title="（6）Jarsigner工具"></a>（6）Jarsigner工具</h4><ol>
<li>读取keystore签名文件</li>
<li>对apk文件进行签名，生成签名后的apk文件</li>
</ol>
<h4 id="（7）zipalign工具"><a href="#（7）zipalign工具" class="headerlink" title="（7）zipalign工具"></a>（7）zipalign工具</h4><ol>
<li>对已签名的apk文件进行体积优化（只有v1签名才有这一步，v2签名的apk会在zipalign后签名被破坏）。</li>
</ol>
<h1 id="三、深入Build"><a href="#三、深入Build" class="headerlink" title="三、深入Build"></a><span id="jump3" />三、深入Build</h1><blockquote>
<p>左下角三种椭圆颜色，代表的是工具归属：</p>
<ul>
<li>黄色：Gradle插件提供（由task完成）</li>
<li>绿色：Build工具提供</li>
<li>紫色：JDK自带工具</li>
</ul>
</blockquote>
<p><img width="600" height="“50”" src="https://note.youdao.com/yws/public/resource/aa2b7a1733f389353b895521feea8e82/xmlnote/WEBRESOURCEaddec6910d7825b33d1c1746a1ff0c5f/10424"></img></p>
<h4 id="（1）左侧红色框框内容"><a href="#（1）左侧红色框框内容" class="headerlink" title="（1）左侧红色框框内容"></a>（1）左侧红色框框内容</h4><ol>
<li>这部分内容是Render Script、ndk相关编译的</li>
<li>主要是提供 .so文件相关和部分JNI java接口的。</li>
</ol>
<h4 id="（2）看图帮助"><a href="#（2）看图帮助" class="headerlink" title="（2）看图帮助"></a>（2）看图帮助</h4><ol>
<li>以aapt为例，最上层就是，Merge类的Task会对Manifest、Res、Assets进行合并，资源可能来自于项目内部、android.jar、arr等第三方</li>
<li>在javac与dex操作之间多了一个proguard（混淆），proguard读取.class文件，生成混淆后的.class文件，交给dex(或d8)。</li>
</ol>
<h4 id="此图可用于参考，判断具体任务工具的归属，方便我们定制某些操作。"><a href="#此图可用于参考，判断具体任务工具的归属，方便我们定制某些操作。" class="headerlink" title="此图可用于参考，判断具体任务工具的归属，方便我们定制某些操作。"></a>此图可用于参考，判断具体任务工具的归属，方便我们定制某些操作。</h4><h1 id="四、任务角度看-build"><a href="#四、任务角度看-build" class="headerlink" title="四、任务角度看 build"></a><span id="jump4" />四、任务角度看 build</h1><p>assembleRelease命令执行后：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">//以下两个task是预编译工作，暂不关心</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:preBuild UP-TO-DATE</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:preReleaseBuild UP-TO-DATE</span></span><br><span class="line"></span><br><span class="line">//一、aidl编译  NO-SOURCE：代码里没有aidl接口</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:compileReleaseAidl NO-SOURCE</span></span><br><span class="line"></span><br><span class="line">//生成BuildConfig文件</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:generateReleaseBuildConfig</span></span><br><span class="line"></span><br><span class="line">//编译Renderscrip,暂不关心（用于编译内核.rc文件，例如Blur高斯模糊等，在内核层操作GPU的等）</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:compileReleaseRenderscript NO-SOURCE</span></span><br><span class="line">//*</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:javaPreCompileRelease</span></span><br><span class="line"></span><br><span class="line">//一、aapt 过程，合并资源、生成R.jar文件</span><br><span class="line">//生成资源文件并合并</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:generateReleaseResValues</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:generateReleaseResources</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:createReleaseCompatibleScreenManifests</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:extractDeepLinksRelease</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:processReleaseManifest</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:prepareLintJar UP-TO-DATE</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:checkReleaseDuplicateClasses</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:desugarReleaseFileDependencies</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:mergeReleaseResources</span></span><br><span class="line"></span><br><span class="line">//产生build/intermediates/compile_and_runtime_not_namespaced_r_class_jar/release/R.jar文件</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:processReleaseResources</span></span><br><span class="line"></span><br><span class="line">//三、javac将java编译成Class文件</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:compileReleaseJavaWithJavac</span></span><br><span class="line"></span><br><span class="line">//将资源文件编译并生成resource.arsc文件，并放入.ap_文件中(./app/build/intermediates/processed_res/release/out/resources-release.ap_)</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:compileReleaseSources</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:lintVitalRelease</span></span><br><span class="line"></span><br><span class="line">//四、dex工具将.class文件编程传.dex文件</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:dexBuilderRelease</span></span><br><span class="line"></span><br><span class="line">//合并非res/的资源文件及assets文件</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:mergeExtDexRelease</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:mergeReleaseShaders</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:compileReleaseShaders NO-SOURCE</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:generateReleaseAssets UP-TO-DATE</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:mergeReleaseAssets</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:processReleaseJavaRes NO-SOURCE</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:collectReleaseDependencies</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:sdkReleaseDependencyData</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:mergeReleaseJniLibFolders</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:mergeReleaseNativeLibs</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:stripReleaseDebugSymbols NO-SOURCE</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:mergeReleaseJavaResource</span></span><br><span class="line"></span><br><span class="line">//合并.dex文件</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:mergeDexRelease</span></span><br><span class="line"></span><br><span class="line">//五、apkbuilder </span><br><span class="line">//将.dex文件、.ap_打包进以及非res资源文件打包进.apk文件中并签名</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:packageRelease</span></span><br><span class="line"></span><br><span class="line">//六、使用zipalign对apk进行体积优化、Jarsigner签名</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Task :app:assembleRelease</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="五、手动build-简单示例"><a href="#五、手动build-简单示例" class="headerlink" title="五、手动build 简单示例"></a><span id="jump5" />五、手动build 简单示例</h1><h5 id="1、编译项目中的res资源文件-assets除外-，生成对应二进制资源文件，并将这些二进制文件打包进res-zip文件中"><a href="#1、编译项目中的res资源文件-assets除外-，生成对应二进制资源文件，并将这些二进制文件打包进res-zip文件中" class="headerlink" title="1、编译项目中的res资源文件(assets除外)，生成对应二进制资源文件，并将这些二进制文件打包进res.zip文件中"></a>1、编译项目中的res资源文件(assets除外)，生成对应二进制资源文件，并将这些二进制文件打包进res.zip文件中</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aapt2 compile -o build/res.zip --dir ./app/src/main/res</span><br></pre></td></tr></table></figure>

<h5 id="2、将res-zip文件与sdk进行连接，生成-ap-文件-包含编译好的资源文件、manifest文件、arsc文件-和R-java文件"><a href="#2、将res-zip文件与sdk进行连接，生成-ap-文件-包含编译好的资源文件、manifest文件、arsc文件-和R-java文件" class="headerlink" title="2、将res.zip文件与sdk进行连接，生成.ap_文件(包含编译好的资源文件、manifest文件、arsc文件)和R.java文件"></a>2、将res.zip文件与sdk进行连接，生成.ap_文件(包含编译好的资源文件、manifest文件、arsc文件)和R.java文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aapt2 link build/res.zip -I $ANDROID_HOME/platforms/android-28/android.jar --java build --manifest ./app/src/main/AndroidManifest.xml -o build/app-debug.ap_</span><br></pre></td></tr></table></figure>

<h5 id="3、将java文件编译成-class文件"><a href="#3、将java文件编译成-class文件" class="headerlink" title="3、将java文件编译成.class文件"></a>3、将java文件编译成.class文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac -d build -cp $ANDROID_HOME/platforms/android-28/android.jar build/com/myapplication/*.java</span><br></pre></td></tr></table></figure>

<h5 id="4、将上一步中生成的-class文件编译成-dex文件（28-0-2-build-tools后加入d8）"><a href="#4、将上一步中生成的-class文件编译成-dex文件（28-0-2-build-tools后加入d8）" class="headerlink" title="4、将上一步中生成的.class文件编译成.dex文件（28.0.2 build-tools后加入d8）"></a>4、将上一步中生成的.class文件编译成.dex文件（28.0.2 build-tools后加入d8）</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d8 --output build/ --lib $ANDROID_HOME/platforms/android-28/android.jar build/com/myapplication/*.class</span><br></pre></td></tr></table></figure>

<h5 id="5、使用zip命令打包第-2-步中的-ap-资源文件与第-4-步中的-dex文件，打包成一个未签名的apk"><a href="#5、使用zip命令打包第-2-步中的-ap-资源文件与第-4-步中的-dex文件，打包成一个未签名的apk" class="headerlink" title="5、使用zip命令打包第(2)步中的.ap_资源文件与第(4)步中的.dex文件，打包成一个未签名的apk"></a>5、使用zip命令打包第(2)步中的.ap_资源文件与第(4)步中的.dex文件，打包成一个未签名的apk</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1、zip -j build/app-debug.ap_ build/classes.dex</span><br><span class="line">2、手动修改ap_ 为apk后缀</span><br></pre></td></tr></table></figure>

<h5 id="6、签名"><a href="#6、签名" class="headerlink" title="6、签名"></a>6、签名</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apksigner sign --ks ~/.android/debug.keystore app-debug.apk</span><br></pre></td></tr></table></figure>

<h1 id="六、gradle插件基础"><a href="#六、gradle插件基础" class="headerlink" title="六、gradle插件基础"></a><span id="jump6" />六、gradle插件基础</h1><h3 id="（1）gradle声明周期"><a href="#（1）gradle声明周期" class="headerlink" title="（1）gradle声明周期"></a>（1）gradle声明周期</h3><table>
<thead>
<tr>
<th>阶段</th>
<th>中文</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>Initialization</td>
<td>初始化</td>
<td>Gradle 解析构建脚本和插件，并构建项目对象模型（Project Object Model，POM）。</td>
</tr>
<tr>
<td>Configuration</td>
<td>配置阶段</td>
<td>Gradle 执行构建脚本中的任务和插件，并解析所有的依赖项和配置项。此阶段是构建过程中最重要的一步，因为它确定了构建过程的具体内容。</td>
</tr>
<tr>
<td>Execution</td>
<td>执行阶段</td>
<td>Gradle 执行各个任务并生成构建产物，例如二进制文件、文档和测试报告。在此阶段，Gradle 将执行所有编译、测试、打包和发布操作</td>
</tr>
<tr>
<td>Completion</td>
<td>完成阶段</td>
<td>Gradle 生成最终的构建产物并清理所有的中间文件和临时文件。此阶段还包括生成构建报告和执行其他必要的收尾操作。</td>
</tr>
</tbody></table>
<h3 id="（2）gradle生命周期监听"><a href="#（2）gradle生命周期监听" class="headerlink" title="（2）gradle生命周期监听"></a>（2）gradle生命周期监听</h3><table>
<thead>
<tr>
<th>方法</th>
<th>阶段</th>
<th>作用</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>beforeEvaluate</td>
<td>配置阶段开始之前</td>
<td>解析构建脚本和插件之前执行一些操作。</td>
<td></td>
</tr>
<tr>
<td>afterEvaluate</td>
<td>配置阶段结束之后</td>
<td>执行构建脚本和插件之后执行一些操作</td>
<td>常用</td>
</tr>
<tr>
<td>beforeExecute</td>
<td>任务执行之前</td>
<td></td>
<td></td>
</tr>
<tr>
<td>afterExecute</td>
<td>任务执行之后</td>
<td></td>
<td></td>
</tr>
<tr>
<td>buildFinished</td>
<td>构建过程结束</td>
<td>清理中间文件和临时文件之前执行一些操作</td>
<td></td>
</tr>
<tr>
<td>settingsEvaluated</td>
<td>解析 settings.gradle 文件之后</td>
<td>配置阶段之前执行一些操作</td>
<td></td>
</tr>
<tr>
<td>projectsEvaluated</td>
<td>解析所有项目之后</td>
<td>配置阶段结束之后执行一些操作</td>
<td></td>
</tr>
</tbody></table>
<h3 id="（3）gradle插件常用api"><a href="#（3）gradle插件常用api" class="headerlink" title="（3）gradle插件常用api"></a>（3）gradle插件常用api</h3><table>
<thead>
<tr>
<th>API</th>
<th>作用</th>
<th>补充</th>
</tr>
</thead>
<tbody><tr>
<td>registerTask(name, Action&lt;? super Task&gt; cA)</td>
<td>注册一个自定义任务，其中 name 是任务的名称，configureAction 是配置任务的操作</td>
<td></td>
</tr>
<tr>
<td>registerJavaGeneratingTask(task,src)</td>
<td>注册一个生成 Java 代码的任务，这个任务会在编译期间自动生成 Java 代码</td>
<td></td>
</tr>
<tr>
<td>registerTransform(TransformAction)</td>
<td>注册一个转换器，其中 action 是转换器的操作。例如：</td>
<td></td>
</tr>
<tr>
<td>registerResGeneratingTask(taskProvider, File)</td>
<td>生成资源的任务，其中 taskProvider 是任务提供者，generatedDirectories 是资源生成目录</td>
<td></td>
</tr>
<tr>
<td>registerTransformOutputProvider( taskProvider, File)</td>
<td>注册一个转换器输出提供者，其中 taskProvider 是任务提供者，outputDirectories 是转换器输出目录</td>
<td></td>
</tr>
<tr>
<td>registerTransformInputProvider(taskProvider)</td>
<td>注册一个转换器输入提供者，其中 taskProvider 是任务提供者</td>
<td></td>
</tr>
<tr>
<td>registerTransformInvocationListener(Action&lt;? super TransformInvocation&gt; action)</td>
<td>注册一个转换器调用监听器</td>
<td></td>
</tr>
</tbody></table>
<h3 id="（4）gradle常用示例"><a href="#（4）gradle常用示例" class="headerlink" title="（4）gradle常用示例"></a>（4）gradle常用示例</h3><h4 id="1-编译前操作-java"><a href="#1-编译前操作-java" class="headerlink" title="1. 编译前操作.java"></a>1. 编译前操作.java</h4><blockquote>
<p>javac前操作.java：生成自定义java文件，合并后编译到apk中。</p>
<p>常用工具：javassit、javapoet工具</p>
</blockquote>
<ul>
<li>Arouter：结合APT（Annotation Processing Tool）构建时自动生成代码初始化map</li>
<li>ButterKnife、DataBinding、ViewBinding：生成初始化view文件</li>
</ul>
<h4 id="2-编译后操作-class"><a href="#2-编译后操作-class" class="headerlink" title="2. 编译后操作.class"></a>2. 编译后操作.class</h4><blockquote>
<p>javac后操作.class：操作编译后的字节码文件，进行特殊化处理。</p>
<p>常用工具：Transform、ASM工具</p>
</blockquote>
<ol>
<li>Arouter：classpath “com.alibaba:arouter-register:? 插桩，直接修改.class文件init()方法，在build期间遍历初始化文件，写入loadRouterMap()方法中。</li>
<li>插桩埋点等</li>
</ol>
<h1 id="七、GarbageCode示例"><a href="#七、GarbageCode示例" class="headerlink" title="七、GarbageCode示例"></a><span id="jump7" />七、GarbageCode示例</h1><h4 id="1-插件library创建问题"><a href="#1-插件library创建问题" class="headerlink" title="(1)插件library创建问题"></a><font id="jump1_1">(1)插件library创建问题</h4><blockquote>
<p>插件library创建时使用java的library，不要用android的。影响javapoet工具使用jdk的类。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javax.lang.model.element.Modifier</span><br></pre></td></tr></table></figure>

<h4 id="2-通过maven的uploadArchives构建"><a href="#2-通过maven的uploadArchives构建" class="headerlink" title="(2)通过maven的uploadArchives构建"></a><font id="jump1_2">(2)通过maven的uploadArchives构建</h4><ul>
<li><font id="jump1_2_1">1、这个group和version信息就是引用时的classpath的前缀和version</li>
<li><font id="jump1_2_2">2、中间的GarbageProguard默认是library的名称</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">classpath <span class="string">&quot;com.garbage.proguard:GarbageProguard:1.1.0&quot;</span></span><br><span class="line">在uploadAchives执行完后在build的maven-metadata.xml中可以看到。</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/public/resource/6229899cffb9d388f3db061be16b6eca/xmlnote/4679CB056ABE4E9B9761744134008911/7971"></img></p>
<ul>
<li><font id="jump1_2_3">3、在使用时apply plugin “garbage-code”是在resource&#x2F;META-INF&#x2F;gradle-plugins&#x2F;*.properties设置的。</li>
</ul>
<p>![image](<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/IRVING18/pic/master/Gradle">https://raw.githubusercontent.com/IRVING18/pic/master/Gradle</a> 构建过程&amp;插件分享_1.jpg)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">group = <span class="string">&#x27;com.garbage.proguard&#x27;</span></span><br><span class="line">version = <span class="string">&#x27;1.1.0&#x27;</span></span><br><span class="line"></span><br><span class="line">uploadArchives &#123;</span><br><span class="line">    configuration = configurations.archives</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenDeployer &#123;</span><br><span class="line">            repository(url: uri(<span class="string">&#x27;../repo&#x27;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-在项目中使用"><a href="#3-在项目中使用" class="headerlink" title="(3)在项目中使用"></a><font id="jump2">(3)在项目中使用</h4><ul>
<li>1、在项目根build.gradle中引入插件</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line">        mavenCentral()</span><br><span class="line">        mavenLocal()</span><br><span class="line">        maven &#123;</span><br><span class="line">            url <span class="title function_">uri</span><span class="params">(<span class="string">&#x27;./repo&#x27;</span>)</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath <span class="string">&quot;com.android.tools.build:gradle:4.1.3&quot;</span></span><br><span class="line"></span><br><span class="line">        classpath <span class="string">&quot;com.garbage.proguard:GarbageProguard:1.1.0&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">plugins &#123;</span><br><span class="line">    id <span class="string">&#x27;com.android.application&#x27;</span></span><br><span class="line">    id <span class="string">&#x27;kotlin-android&#x27;</span></span><br><span class="line">    id <span class="string">&#x27;kotlin-kapt&#x27;</span></span><br><span class="line">    id <span class="string">&#x27;project-report&#x27;</span></span><br><span class="line">    id <span class="string">&#x27;garbage-code&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-核心代码"><a href="#4-核心代码" class="headerlink" title="(4)核心代码"></a>(4)核心代码</h3><blockquote>
<p>1.variant.registerJavaGeneratingTask(task,目录) 注册java代码任务，注册后gradle会在编译前先执行该task，合并生成目录下的java文件，在javac编译时一起编译。<br>2.variant.registerResGeneratingTask() 注册res生成任务，会在aapt生成res文件时一起打包到R文件</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">apply</span><span class="params">(Project project)</span> &#123;</span><br><span class="line">    <span class="comment">//获取插件使用者在build中插入的配置</span></span><br><span class="line">    <span class="type">def</span> <span class="variable">generateGarbageCodeExt</span> <span class="operator">=</span> project.extensions.create(<span class="string">&quot;androidGarbageCode&quot;</span>, AndroidGarbageCodeExt)</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    project.afterEvaluate &#123;</span><br><span class="line">        <span class="comment">//遍历当前所有buildType：debug、release等等</span></span><br><span class="line">        android.applicationVariants.all &#123; variant -&gt;</span><br><span class="line">            <span class="type">def</span> <span class="variable">variantName</span> <span class="operator">=</span> variant.name</span><br><span class="line">            <span class="comment">//通过用户配置的map，获取当前buildType是否有相关配置。</span></span><br><span class="line">            Closure&lt;GarbageCodeConfig&gt; garbageCodeConfig = generateGarbageCodeExt.configMap[variantName]</span><br><span class="line">            <span class="keyword">if</span> (garbageCodeConfig) &#123;</span><br><span class="line">                <span class="comment">//自定义build路径</span></span><br><span class="line">                <span class="type">def</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(project.buildDir, <span class="string">&quot;generated/source/garbage/$variantName&quot;</span>)</span><br><span class="line">                <span class="type">def</span> <span class="variable">resDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dir, <span class="string">&quot;res&quot;</span>)</span><br><span class="line">                <span class="type">def</span> <span class="variable">javaDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dir, <span class="string">&quot;java&quot;</span>)</span><br><span class="line">                <span class="type">def</span> <span class="variable">manifestFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dir, <span class="string">&quot;AndroidManifest.xml&quot;</span>)</span><br><span class="line">                <span class="comment">//通过buildType查找当前packageName，包名</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">packageName</span> <span class="operator">=</span> findPackageName(variant)</span><br><span class="line">                <span class="comment">//创建并执行task：GarbageCodeTask</span></span><br><span class="line">                <span class="type">def</span> <span class="variable">generateGarbageCodeTask</span> <span class="operator">=</span> project.task(<span class="string">&quot;generate$&#123;variantName.capitalize()&#125;GarbageCode&quot;</span>, type: GarbageCodeTask) &#123;</span><br><span class="line">                    <span class="comment">//给GarbageCodeTask变量赋值</span></span><br><span class="line">                    garbageCodeConfig.delegate = config</span><br><span class="line">                    garbageCodeConfig.resolveStrategy = DELEGATE_FIRST</span><br><span class="line">                    garbageCodeConfig.call()</span><br><span class="line">                    manifestPackageName = <span class="type">packageName</span></span><br><span class="line">                    <span class="variable">outDir</span> <span class="operator">=</span> dir</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//1、合并AndroidManifest文件</span></span><br><span class="line">                <span class="comment">//在GarbageCodeTask中会在resDir、javaDir、javaDir路径下去生成相应的文件。这是代码AGarbageCodeTask协定好写死的，并没有通过参数传递，可以自己改</span></span><br><span class="line">                <span class="comment">//将GarbageCodeTask自动生成的AndroidManifest.xml加入到一个未被占用的manifest位置(如果都占用了就不合并了，通常较少出现全被占用情况)</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> variant.sourceSets.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">                    <span class="type">def</span> <span class="variable">sourceSet</span> <span class="operator">=</span> variant.sourceSets[i]</span><br><span class="line">                    <span class="keyword">if</span> (!sourceSet.manifestFile.exists()) &#123;</span><br><span class="line">                        android.sourceSets.<span class="string">&quot;$&#123;sourceSet.name&#125;&quot;</span>.manifest.srcFile(manifestFile.absolutePath)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//2、合并res资源文件</span></span><br><span class="line">                <span class="keyword">if</span> (variant.respondsTo(<span class="string">&quot;registerGeneratedResFolders&quot;</span>)) &#123;</span><br><span class="line">                    generateGarbageCodeTask.ext.generatedResFolders = project</span><br><span class="line">                            .files(resDir)</span><br><span class="line">                            .builtBy(generateGarbageCodeTask)</span><br><span class="line">                    variant.registerGeneratedResFolders(generateGarbageCodeTask.generatedResFolders)</span><br><span class="line">                    <span class="keyword">if</span> (variant.hasProperty(<span class="string">&quot;mergeResourcesProvider&quot;</span>)) &#123;</span><br><span class="line">                        variant.mergeResourcesProvider.configure &#123; dependsOn(generateGarbageCodeTask) &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">//noinspection GrDeprecatedAPIUsage</span></span><br><span class="line">                        variant.mergeResources.dependsOn(generateGarbageCodeTask)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//noinspection GrDeprecatedAPIUsage</span></span><br><span class="line">                    variant.registerResGeneratingTask(generateGarbageCodeTask, resDir)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//3、合并java文件</span></span><br><span class="line">                variant.registerJavaGeneratingTask(generateGarbageCodeTask, javaDir)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>javapoet 生成java文件示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">generateActivity</span><span class="params">(String packageName, String activityPreName)</span> &#123;</span><br><span class="line">       <span class="type">def</span> <span class="variable">javaDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(outDir, <span class="string">&quot;java&quot;</span>)</span><br><span class="line">       <span class="type">def</span> <span class="variable">className</span> <span class="operator">=</span> activityPreName.capitalize() + <span class="string">&quot;Activity&quot;</span></span><br><span class="line">       <span class="type">def</span> <span class="variable">layoutName</span> <span class="operator">=</span> <span class="string">&quot;$&#123;config.resPrefix.toLowerCase()&#125;$&#123;packageName.replace(&quot;</span>.<span class="string">&quot;, &quot;</span>_<span class="string">&quot;)&#125;_activity_$&#123;activityPreName&#125;&quot;</span></span><br><span class="line">       generateLayout(layoutName)</span><br><span class="line">       <span class="keyword">if</span> (!config.excludeActivityJavaFile) &#123;</span><br><span class="line">           <span class="type">def</span> <span class="variable">typeBuilder</span> <span class="operator">=</span> TypeSpec.classBuilder(className)</span><br><span class="line">           typeBuilder.superclass(ClassName.get(<span class="string">&quot;android.app&quot;</span>, <span class="string">&quot;Activity&quot;</span>))</span><br><span class="line">           typeBuilder.addModifiers(Modifier.PUBLIC)</span><br><span class="line">           <span class="comment">//onCreate方法</span></span><br><span class="line">           <span class="type">def</span> <span class="variable">bundleClassName</span> <span class="operator">=</span> ClassName.get(<span class="string">&quot;android.os&quot;</span>, <span class="string">&quot;Bundle&quot;</span>)</span><br><span class="line">           typeBuilder.addMethod(MethodSpec.methodBuilder(<span class="string">&quot;onCreate&quot;</span>)</span><br><span class="line">                   .addAnnotation(Override.class)</span><br><span class="line">                   .addModifiers(Modifier.PROTECTED)</span><br><span class="line">                   .addParameter(bundleClassName, <span class="string">&quot;savedInstanceState&quot;</span>)</span><br><span class="line">                   .addStatement(<span class="string">&quot;super.onCreate(savedInstanceState)&quot;</span>)</span><br><span class="line">                   .addStatement(<span class="string">&quot;setContentView(\$T.layout.$&#123;layoutName&#125;)&quot;</span>, ClassName.get(manifestPackageName, <span class="string">&quot;R&quot;</span>))</span><br><span class="line">                   .build())</span><br><span class="line">           <span class="comment">//其它方法</span></span><br><span class="line">           <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; config.methodCountPerClass; j++) &#123;</span><br><span class="line">               <span class="type">def</span> <span class="variable">methodName</span> <span class="operator">=</span> generateName(j)</span><br><span class="line">               <span class="type">def</span> <span class="variable">methodBuilder</span> <span class="operator">=</span> MethodSpec.methodBuilder(methodName)</span><br><span class="line">               generateMethods(methodBuilder)</span><br><span class="line">               typeBuilder.addMethod(methodBuilder.build())</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="type">def</span> <span class="variable">fileBuilder</span> <span class="operator">=</span> JavaFile.builder(packageName, typeBuilder.build())</span><br><span class="line">           fileBuilder.build().writeTo(javaDir)</span><br><span class="line">       &#125;</span><br><span class="line">       addToManifestByFileIo(className, packageName)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>文件</th>
<th>作用</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>R.java</td>
<td>用于在应用程序中访问应用程序的资源，如布局、字符串、图像、样式等，包含了应用程序中所有资源的 ID 和一些辅助方法和常量</td>
<td></td>
</tr>
<tr>
<td>resource.arsc</td>
<td>二进制索引文件，只包含了应用程序的编译后二进制形式的资源，而不包含原始的资源文件，例如.png文件。</td>
<td>可以将 “resources.arsc” 看作一个索引或字典，它存储了应用程序中所有的资源信息，包括资源类型、名称、ID 等。在 Android 应用程序运行时，系统使用 “resources.arsc” 中的信息来快速地定位和加载资源，从而提高应用程序的性能。</td>
</tr>
</tbody></table>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://irving18.github.io">王征</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://irving18.github.io/2022/11/27/Gradle%20%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B&amp;%E6%8F%92%E4%BB%B6%E5%88%86%E4%BA%AB/">https://irving18.github.io/2022/11/27/Gradle%20%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B&amp;%E6%8F%92%E4%BB%B6%E5%88%86%E4%BA%AB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://irving18.github.io" target="_blank">Android高级直通车</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android%E8%BF%9B%E9%98%B6/">Android进阶</a><a class="post-meta__tags" href="/tags/Gradle%E6%8F%92%E4%BB%B6/">Gradle插件</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat_pay.png" target="_blank"><img class="post-qr-code-img" src="/img/wechat_pay.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2022/11/30/Gradle-AGP%E5%8E%9F%E7%90%86/" title="Gradle-AGP原理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Gradle-AGP原理</div></div><div class="info-2"><div class="info-item-1">目录 一、Gradle编译入手 二、AGP：Android Gradle Plugin 三、Transform 四、ASM （1）ASM框架核心方法 （2）ASM使用示例  1、自定的ClassVisitor类，获取类名、接口信息  2、自定的MethodVisitor，在visitInsn()中插入代码   参考链接  一、Gradle编译入手在AndroidStudio的Terminal中，输入打包命令：.&#x2F;gradlew app:assembleDebug –console&#x3D;plain，输出如下： 12345678:app:preBuild...</div></div></div></a><a class="pagination-related" href="/2022/05/20/Handler-%E5%90%8C%E6%AD%A5%E5%B1%8F%E9%9A%9C&amp;runWithScissors/" title="Handler-同步屏障&amp;runWithScissors"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Handler-同步屏障&runWithScissors</div></div><div class="info-2"><div class="info-item-1">目录 一、同步屏障工作原理 （1）发送普通消息时 （2）发送同步屏障时 （3）读取同步屏障时   二、同步屏障作用 三、Handler的runWithScissors(Runnable r, long timeout) （1）方法作用 （2）调用后具体分为两种情况 （3）具体说明   参考文章 runWithScissors 参考1 参考2    一、同步屏障工作原理（1）发送普通消息时在发送消息时，  1、当Handler().postMessage()&#x2F;sendMessage()时最终都会调用enqueueMessage()，而在这里会将target设置为Handler本身； 而且Handler.enqueuMessage()会调用MessageQueue.enqueueMessage()   2、在MessageQueue中是不允许 target 属性为空的，否则会抛出异常；  1234567891011# Handler.javaprivate boolean enqueueMessage(@NonNull MessageQueue queue,...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2022/11/30/Gradle-AGP%E5%8E%9F%E7%90%86/" title="Gradle-AGP原理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-30</div><div class="info-item-2">Gradle-AGP原理</div></div><div class="info-2"><div class="info-item-1">目录 一、Gradle编译入手 二、AGP：Android Gradle Plugin 三、Transform 四、ASM （1）ASM框架核心方法 （2）ASM使用示例  1、自定的ClassVisitor类，获取类名、接口信息  2、自定的MethodVisitor，在visitInsn()中插入代码   参考链接  一、Gradle编译入手在AndroidStudio的Terminal中，输入打包命令：.&#x2F;gradlew app:assembleDebug –console&#x3D;plain，输出如下： 12345678:app:preBuild...</div></div></div></a><a class="pagination-related" href="/2022/12/07/Gradle-APT%E5%8E%9F%E7%90%86/" title="Gradle-APT原理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-07</div><div class="info-item-2">Gradle-APT原理</div></div><div class="info-2"><div class="info-item-1">目录 一、APT简介 二、看下java编译过程 三、自定义AbstractProcessor （1）继承自javax.annotation.processing.AbstractProcessor。 （2）添加注解 （3）重写了init()和process()两个方法。 （4）示例代码   参考链接  一、APT简介APT(Annotation Processing Tool)，即 注解处理器，是javac中提供的编译时扫描和处理注解的工具，它对源代码文件进行检测找出其中的注解，然后使用注解进行额外的处理。  1、注解：就像标签，将需要的标识通过注解写入； 2、注解处理器：javax.annotation.processing.AbstractProcessor...</div></div></div></a><a class="pagination-related" href="/2024/03/07/ANR%E6%9C%BA%E5%88%B6%E5%8E%9F%E7%90%86%E3%80%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" title="ANR机制原理、解决方案"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-07</div><div class="info-item-2">ANR机制原理、解决方案</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="/2024/05/17/Dalvik&ART/" title="Dalvik&amp;ART"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-17</div><div class="info-item-2">Dalvik&amp;ART</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="/2024/08/27/Framework%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6%E7%AF%87-BroadCast%E4%BD%BF%E7%94%A8/" title="Framework四大组件篇-BroadCast使用"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-27</div><div class="info-item-2">Framework四大组件篇-BroadCast使用</div></div><div class="info-2"><div class="info-item-1">目录 一、广播接收 （1）静态注册 （2）动态注册 （3）接收优先级 （4）前台广播、后台广播   二、广播发送 （1）无序广播 （2）有序广播 给下游传输数据、中断广播   （3）粘性广播（异步广播） （4）粘性有序广播 （5）前台广播、后台广播   三、常用系统广播汇总 （1）开机广播 （2）网络状态广播 （3）电量变化   四、Interview常见问题 （1）广播的超时时间 （2）广播中想做耗时操作，应该怎么搞？    一、广播接收定义一个默认广播，用于接收广播消息； 12345678910111213class MyBroadCast : BroadcastReceiver() &#123;    companion object &#123;        val WZ_RECEIVER = &quot;com.wz.test.MyTestBroadCast&quot;    &#125;    override fun onReceive(context: Context, intent: Intent) &#123;       ...</div></div></div></a><a class="pagination-related" href="/2024/08/30/Framework%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6%E7%AF%87-BroadCast%E5%8E%9F%E7%90%86%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="Framework四大组件篇-BroadCast原理源码分析"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-30</div><div class="info-item-2">Framework四大组件篇-BroadCast原理源码分析</div></div><div class="info-2"><div class="info-item-1"> AMS：http://aospxref.com/android-6.0.1_r9/xref/frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.javaAMN&#x2F;AMP：http://aospxref.com/android-6.0.1_r9/xref/frameworks/base/core/java/android/app/ActivityManagerNative.java  目录 一、总结先行 （1）广播处理机制？ （2）ANR：无序广播、有序广播？ （3）ANR时间：前台、后台？ （4）ANR：静态注册会有ANR吗？ （5）静态注册拉起进程？Android...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">王征</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/IRVING18"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:ivring18@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><span>Android开发者迈向<span style="color:red; weight:bold" >高级Android开发</span>的直通车，总结了各大面试考点！<span></br><span>一个通人性的博主，码字不易，用爱发电。希望大家多多支持。</span><img width="250px" src="/img/wechat_pay.png"></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-number">1.</span> <span class="toc-text">目录</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%88%9D%E8%A7%81Build"><span class="toc-number">2.</span> <span class="toc-text">一、初见Build</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%8F%88%E8%A7%81Build"><span class="toc-number">3.</span> <span class="toc-text">二、又见Build</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89aapt%E5%B7%A5%E5%85%B7"><span class="toc-number">3.0.0.1.</span> <span class="toc-text">（1）aapt工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89aidl%E5%B7%A5%E5%85%B7"><span class="toc-number">3.0.0.2.</span> <span class="toc-text">（2）aidl工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89Java-Compiler-%EF%BC%88%E5%8D%B3javaC%EF%BC%89%E5%B7%A5%E5%85%B7"><span class="toc-number">3.0.0.3.</span> <span class="toc-text">（3）Java Compiler （即javaC）工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%884%EF%BC%89dex%E5%B7%A5%E5%85%B7"><span class="toc-number">3.0.0.4.</span> <span class="toc-text">（4）dex工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%885%EF%BC%89apkbuilder%E5%B7%A5%E5%85%B7"><span class="toc-number">3.0.0.5.</span> <span class="toc-text">（5）apkbuilder工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%886%EF%BC%89Jarsigner%E5%B7%A5%E5%85%B7"><span class="toc-number">3.0.0.6.</span> <span class="toc-text">（6）Jarsigner工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%887%EF%BC%89zipalign%E5%B7%A5%E5%85%B7"><span class="toc-number">3.0.0.7.</span> <span class="toc-text">（7）zipalign工具</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%B7%B1%E5%85%A5Build"><span class="toc-number">4.</span> <span class="toc-text">三、深入Build</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%B7%A6%E4%BE%A7%E7%BA%A2%E8%89%B2%E6%A1%86%E6%A1%86%E5%86%85%E5%AE%B9"><span class="toc-number">4.0.0.1.</span> <span class="toc-text">（1）左侧红色框框内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E7%9C%8B%E5%9B%BE%E5%B8%AE%E5%8A%A9"><span class="toc-number">4.0.0.2.</span> <span class="toc-text">（2）看图帮助</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A4%E5%9B%BE%E5%8F%AF%E7%94%A8%E4%BA%8E%E5%8F%82%E8%80%83%EF%BC%8C%E5%88%A4%E6%96%AD%E5%85%B7%E4%BD%93%E4%BB%BB%E5%8A%A1%E5%B7%A5%E5%85%B7%E7%9A%84%E5%BD%92%E5%B1%9E%EF%BC%8C%E6%96%B9%E4%BE%BF%E6%88%91%E4%BB%AC%E5%AE%9A%E5%88%B6%E6%9F%90%E4%BA%9B%E6%93%8D%E4%BD%9C%E3%80%82"><span class="toc-number">4.0.0.3.</span> <span class="toc-text">此图可用于参考，判断具体任务工具的归属，方便我们定制某些操作。</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%BB%BB%E5%8A%A1%E8%A7%92%E5%BA%A6%E7%9C%8B-build"><span class="toc-number">5.</span> <span class="toc-text">四、任务角度看 build</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%89%8B%E5%8A%A8build-%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B"><span class="toc-number">6.</span> <span class="toc-text">五、手动build 简单示例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E7%BC%96%E8%AF%91%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84res%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6-assets%E9%99%A4%E5%A4%96-%EF%BC%8C%E7%94%9F%E6%88%90%E5%AF%B9%E5%BA%94%E4%BA%8C%E8%BF%9B%E5%88%B6%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%EF%BC%8C%E5%B9%B6%E5%B0%86%E8%BF%99%E4%BA%9B%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E6%89%93%E5%8C%85%E8%BF%9Bres-zip%E6%96%87%E4%BB%B6%E4%B8%AD"><span class="toc-number">6.0.0.0.1.</span> <span class="toc-text">1、编译项目中的res资源文件(assets除外)，生成对应二进制资源文件，并将这些二进制文件打包进res.zip文件中</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81%E5%B0%86res-zip%E6%96%87%E4%BB%B6%E4%B8%8Esdk%E8%BF%9B%E8%A1%8C%E8%BF%9E%E6%8E%A5%EF%BC%8C%E7%94%9F%E6%88%90-ap-%E6%96%87%E4%BB%B6-%E5%8C%85%E5%90%AB%E7%BC%96%E8%AF%91%E5%A5%BD%E7%9A%84%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E3%80%81manifest%E6%96%87%E4%BB%B6%E3%80%81arsc%E6%96%87%E4%BB%B6-%E5%92%8CR-java%E6%96%87%E4%BB%B6"><span class="toc-number">6.0.0.0.2.</span> <span class="toc-text">2、将res.zip文件与sdk进行连接，生成.ap_文件(包含编译好的资源文件、manifest文件、arsc文件)和R.java文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%E3%80%81%E5%B0%86java%E6%96%87%E4%BB%B6%E7%BC%96%E8%AF%91%E6%88%90-class%E6%96%87%E4%BB%B6"><span class="toc-number">6.0.0.0.3.</span> <span class="toc-text">3、将java文件编译成.class文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4%E3%80%81%E5%B0%86%E4%B8%8A%E4%B8%80%E6%AD%A5%E4%B8%AD%E7%94%9F%E6%88%90%E7%9A%84-class%E6%96%87%E4%BB%B6%E7%BC%96%E8%AF%91%E6%88%90-dex%E6%96%87%E4%BB%B6%EF%BC%8828-0-2-build-tools%E5%90%8E%E5%8A%A0%E5%85%A5d8%EF%BC%89"><span class="toc-number">6.0.0.0.4.</span> <span class="toc-text">4、将上一步中生成的.class文件编译成.dex文件（28.0.2 build-tools后加入d8）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5%E3%80%81%E4%BD%BF%E7%94%A8zip%E5%91%BD%E4%BB%A4%E6%89%93%E5%8C%85%E7%AC%AC-2-%E6%AD%A5%E4%B8%AD%E7%9A%84-ap-%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E4%B8%8E%E7%AC%AC-4-%E6%AD%A5%E4%B8%AD%E7%9A%84-dex%E6%96%87%E4%BB%B6%EF%BC%8C%E6%89%93%E5%8C%85%E6%88%90%E4%B8%80%E4%B8%AA%E6%9C%AA%E7%AD%BE%E5%90%8D%E7%9A%84apk"><span class="toc-number">6.0.0.0.5.</span> <span class="toc-text">5、使用zip命令打包第(2)步中的.ap_资源文件与第(4)步中的.dex文件，打包成一个未签名的apk</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6%E3%80%81%E7%AD%BE%E5%90%8D"><span class="toc-number">6.0.0.0.6.</span> <span class="toc-text">6、签名</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81gradle%E6%8F%92%E4%BB%B6%E5%9F%BA%E7%A1%80"><span class="toc-number">7.</span> <span class="toc-text">六、gradle插件基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89gradle%E5%A3%B0%E6%98%8E%E5%91%A8%E6%9C%9F"><span class="toc-number">7.0.1.</span> <span class="toc-text">（1）gradle声明周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89gradle%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9B%91%E5%90%AC"><span class="toc-number">7.0.2.</span> <span class="toc-text">（2）gradle生命周期监听</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89gradle%E6%8F%92%E4%BB%B6%E5%B8%B8%E7%94%A8api"><span class="toc-number">7.0.3.</span> <span class="toc-text">（3）gradle插件常用api</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%884%EF%BC%89gradle%E5%B8%B8%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">7.0.4.</span> <span class="toc-text">（4）gradle常用示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%BC%96%E8%AF%91%E5%89%8D%E6%93%8D%E4%BD%9C-java"><span class="toc-number">7.0.4.1.</span> <span class="toc-text">1. 编译前操作.java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%BC%96%E8%AF%91%E5%90%8E%E6%93%8D%E4%BD%9C-class"><span class="toc-number">7.0.4.2.</span> <span class="toc-text">2. 编译后操作.class</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81GarbageCode%E7%A4%BA%E4%BE%8B"><span class="toc-number">8.</span> <span class="toc-text">七、GarbageCode示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%8F%92%E4%BB%B6library%E5%88%9B%E5%BB%BA%E9%97%AE%E9%A2%98"><span class="toc-number">8.0.0.1.</span> <span class="toc-text">(1)插件library创建问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%80%9A%E8%BF%87maven%E7%9A%84uploadArchives%E6%9E%84%E5%BB%BA"><span class="toc-number">8.0.0.2.</span> <span class="toc-text">(2)通过maven的uploadArchives构建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8"><span class="toc-number">8.0.0.3.</span> <span class="toc-text">(3)在项目中使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81"><span class="toc-number">8.0.1.</span> <span class="toc-text">(4)核心代码</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/09/20/Framework%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6%E7%AF%87-Service%EF%BC%9AstartService%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="Framework四大组件篇-Service：startService源码分析">Framework四大组件篇-Service：startService源码分析</a><time datetime="2024-09-20T07:40:47.000Z" title="发表于 2024-09-20 15:40:47">2024-09-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/09/17/Framework%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6%E7%AF%87-Service%EF%BC%9AbindService%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="Framework四大组件篇-Service：bindService源码分析">Framework四大组件篇-Service：bindService源码分析</a><time datetime="2024-09-17T07:40:36.000Z" title="发表于 2024-09-17 15:40:36">2024-09-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/09/16/Framework%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6%E7%AF%87-Service1%E4%BD%BF%E7%94%A8%E7%AF%87/" title="Framework四大组件篇-Service1使用篇">Framework四大组件篇-Service1使用篇</a><time datetime="2024-09-16T07:40:35.000Z" title="发表于 2024-09-16 15:40:35">2024-09-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/09/07/Framework%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6%E7%AF%87-ContentProvider%E5%90%AF%E5%8A%A8%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="Framework四大组件篇-ContentProvider启动源码分析">Framework四大组件篇-ContentProvider启动源码分析</a><time datetime="2024-09-07T07:39:36.000Z" title="发表于 2024-09-07 15:39:36">2024-09-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/30/Framework%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6%E7%AF%87-BroadCast%E5%8E%9F%E7%90%86%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="Framework四大组件篇-BroadCast原理源码分析">Framework四大组件篇-BroadCast原理源码分析</a><time datetime="2024-08-30T07:40:05.000Z" title="发表于 2024-08-30 15:40:05">2024-08-30</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/bg.png);"><div id="footer-wrap"><div class="copyright">&copy;2024 By 王征</div><div class="footer_custom_text"><a href=""><img class="icp-icon" src="/img/avatar.jpg"><span>一个通人性的博主</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>